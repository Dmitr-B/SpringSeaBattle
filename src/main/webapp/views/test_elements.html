<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<div class="battlefield_table_placeholder">
    <table class="battlefield_table">
        <tbody>
        <tr class="battlefield_row">
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="0" data-y="0"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="0" data-y="1"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="0" data-y="2"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="0" data-y="3"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="0" data-y="4"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="0" data-y="5"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="0" data-y="6"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="0" data-y="7"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="0" data-y="8"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="0" data-y="9"></div>
            </td>
        </tr>
        <tr class="battlefield_row">
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="1" data-y="0"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="1" data-y="1"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="1" data-y="2"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="1" data-y="3"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="1" data-y="4"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="1" data-y="5"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="1" data-y="6"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="1" data-y="7"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="1" data-y="8"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="1" data-y="9"></div>
            </td>
        </tr>
        <tr class="battlefield_row">
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="2" data-y="0"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="2" data-y="1"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="2" data-y="2"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="2" data-y="3"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="2" data-y="4"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="2" data-y="5"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="2" data-y="6"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="2" data-y="7"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="2" data-y="8"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="2" data-y="9"></div>
            </td>
        </tr>
        <tr class="battlefield_row">
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="3" data-y="0"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="3" data-y="1"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="3" data-y="2"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="3" data-y="3"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="3" data-y="4"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="3" data-y="5"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="3" data-y="6"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="3" data-y="7"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="3" data-y="8"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="3" data-y="9"></div>
            </td>
        </tr>
        <tr class="battlefield_row">
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="4" data-y="0"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="4" data-y="1"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="4" data-y="2"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="4" data-y="3"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="4" data-y="4"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="4" data-y="5"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="4" data-y="6"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="4" data-y="7"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="4" data-y="8"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="4" data-y="9"></div>
            </td>
        </tr>
        <tr class="battlefield_row">
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="5" data-y="0"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="5" data-y="1"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="5" data-y="2"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="5" data-y="3"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="5" data-y="4"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="5" data-y="5"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="5" data-y="6"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="5" data-y="7"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="5" data-y="8"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="5" data-y="9"></div>
            </td>
        </tr>
        <tr class="battlefield_row">
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="6" data-y="0"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="6" data-y="1"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="6" data-y="2"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="6" data-y="3"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="6" data-y="4"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="6" data-y="5"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="6" data-y="6"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="6" data-y="7"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="6" data-y="8"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="6" data-y="9"></div>
            </td>
        </tr>
        <tr class="battlefield_row">
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="7" data-y="0"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="7" data-y="1"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="7" data-y="2"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="7" data-y="3"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="7" data-y="4"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="7" data-y="5"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="7" data-y="6"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="7" data-y="7"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="7" data-y="8"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="7" data-y="9"></div>
            </td>
        </tr>
        <tr class="battlefield_row">
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="8" data-y="0"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="8" data-y="1"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="8" data-y="2"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="8" data-y="3"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="8" data-y="4"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="8" data-y="5"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="8" data-y="6"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="8" data-y="7"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="8" data-y="8"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="8" data-y="9"></div>
            </td>
        </tr>
        <tr class="battlefield_row">
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="9" data-y="0"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="9" data-y="1"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="9" data-y="2"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="9" data-y="3"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="9" data-y="4"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="9" data-y="5"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="9" data-y="6"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="9" data-y="7"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="9" data-y="8"></div>
            </td>
            <td class="battlefield_cell battlefield_cell_empty">
                <div class="battlefield_cell_content" data-x="9" data-y="9"></div>
            </td>
        </tr>
        </tbody>
    </table>

    <div class="wrap">
        <div class="battlefield">
            <div class="play_field">
                <div id="field-player" class="shipDto"></div>
            </div>

        </div>
    </div>

    <div class="table1">
        <table class="battlefield_player">
            <tr>
                <th id="test1">0</th>
                <th>1</th>
                <th>2</th>
                <th>3</th>
                <th>4</th>
                <th>5</th>
                <th>6</th>
                <th>7</th>
                <th>8</th>
                <th>9</th>
            </tr>
            <tr>
                <th>10</th>
                <th>11</th>
                <th>12</th>
                <th>13</th>
                <th>14</th>
                <th>15</th>
                <th>16</th>
                <th>17</th>
                <th>18</th>
                <th>19</th>
            </tr>
            <tr>
                <th>20</th>
                <th>21</th>
                <th>22</th>
                <th>23</th>
                <th>24</th>
                <th>25</th>
                <th>26</th>
                <th>27</th>
                <th>28</th>
                <th>29</th>
            </tr>
            <tr>
                <th>30</th>
                <th>31</th>
                <th>32</th>
                <th>33</th>
                <th>34</th>
                <th>35</th>
                <th>36</th>
                <th>37</th>
                <th>38</th>
                <th>39</th>
            </tr>
            <tr>
                <th>40</th>
                <th>41</th>
                <th>42</th>
                <th>43</th>
                <th>44</th>
                <th>45</th>
                <th>46</th>
                <th>47</th>
                <th>48</th>
                <th>49</th>
            </tr>
            <tr>
                <th>50</th>
                <th>51</th>
                <th>52</th>
                <th>53</th>
                <th>54</th>
                <th>55</th>
                <th>56</th>
                <th>57</th>
                <th>58</th>
                <th>59</th>
            </tr>
            <tr>
                <th>60</th>
                <th>61</th>
                <th>62</th>
                <th>63</th>
                <th>64</th>
                <th>65</th>
                <th>66</th>
                <th>67</th>
                <th>68</th>
                <th>69</th>
            </tr>
            <tr>
                <th>70</th>
                <th>71</th>
                <th>72</th>
                <th>73</th>
                <th>74</th>
                <th>75</th>
                <th>76</th>
                <th>77</th>
                <th>78</th>
                <th>79</th>
            </tr>
            <tr>
                <th>80</th>
                <th>81</th>
                <th>82</th>
                <th>83</th>
                <th>84</th>
                <th>85</th>
                <th>86</th>
                <th>87</th>
                <th>88</th>
                <th>89</th>
            </tr>
            <tr>
                <th>90</th>
                <th>91</th>
                <th>92</th>
                <th>93</th>
                <th>94</th>
                <th>95</th>
                <th>96</th>
                <th>97</th>
                <th>98</th>
                <th>99</th>
            </tr>
        </table>
    </div>
</div>

<script>
    let activeSingleShip = null; /* add change active ship with cursor */
    let allSingleDeckShips = document.querySelectorAll('.singleDeckShip');
    let singleDeckShip = null;
    let startSingleDeckCell = null;
    let currentDroppable = null;
    let startX = null;
    let startY = null;
    let buttonX = null;
    let buttonY = null;

    window.onmousemove = function (e) {

        switch (document.elementFromPoint(e.clientX, e.clientY).id) {
            case "singleDeckShip_1":
                activeSingleShip = 0;
                break;
            case "singleDeckShip_2":
                activeSingleShip = 1;
                break;
            case "singleDeckShip_3":
                activeSingleShip = 2;
                break;
            case "singleDeckShip_4":
                activeSingleShip = 3;
                break;
        }

        if (activeSingleShip != null) {
            singleDeckShip = document.getElementById(allSingleDeckShips[activeSingleShip].id)
            singleDeckShip.onmousedown = function (e) {

                let coords = getCoords(singleDeckShip);
                let shiftX = e.pageX - coords.left;
                let shiftY = e.pageY - coords.top;

                startX = coords.left;
                startY = coords.top;
                singleDeckShip.style.position = "absolute";
                hideApplyButton();
                moveAt(e)
                document.body.appendChild(singleDeckShip);
                singleDeckShip.style.zIndex = "1000";

                function moveAt(e) {
                    singleDeckShip.style.left = e.pageX - shiftX + "px";
                    singleDeckShip.style.top = e.pageY - shiftY + "px";
                }

                document.onmousemove = function (e) {

                    moveAt(e);
                    singleDeckShip.hidden = true;
                    const elemBelow = document.elementFromPoint(e.clientX, e.clientY);
                    singleDeckShip.hidden = false;
                    let cell = document.getElementById(elemBelow.id);

                    if (cell !== null) {
                        startSingleDeckCell = cell;
                        moveToCellAndSetButtonCoordinates(cell);
                    }

                    let droppableBelow = elemBelow.closest(".test_table");

                    if (currentDroppable !== droppableBelow) {
                        if (currentDroppable) {
                            leaveDroppable(singleDeckShip);
                        }

                        currentDroppable = droppableBelow;

                        if (currentDroppable) {
                            enterDroppable(singleDeckShip);
                        }
                    }
                }

                singleDeckShip.onmouseup = function () {
                    document.onmousemove = null;
                    singleDeckShip.onmouseup = null;

                    if (currentDroppable != null) {
                        if (document.getElementById(currentDroppable.id).className === "test_table") {
                            showApplyButton();
                        }
                    } else {
                        moveToStart();
                    }
                }
            }
            singleDeckShip.ondragstart = function() {
                return false;
            }
        }
    }

    function getCoords(elem) {
        let box = elem.getBoundingClientRect();
        return {
            top: box.top + pageYOffset,
            left: box.left + pageXOffset,
            bottom: box.bottom,
            right: box.right
        }
    }

    function getCellCoords(elem) {
        let box = elem.getBoundingClientRect();
        return {
            top: box.top,
            left: box.left
        }
    }

    function enterDroppable(elem) {
        elem.style.backgroundColor = 'rgba(144,238,144,0.3)';
        elem.style.borderColor = 'green';
    }

    function leaveDroppable(elem) {
        elem.style.background = '';
        elem.style.opacity = '1';
        elem.style.borderColor = 'mediumblue';
        currentDroppable = null;
    }

    function moveToStart() {
        singleDeckShip.style.left = startX + "px";
        singleDeckShip.style.top = startY + "px";
        leaveDroppable(singleDeckShip);
        alert("1 " + singleDeckShip.style.left + " " + startX);
        alert("2 " + singleDeckShip.style.top + " " + startY);
    }

    function moveToCellAndSetButtonCoordinates(element) {
        singleDeckShip.style.left = getCellCoords(element).left.valueOf()-1 + "px";
        singleDeckShip.style.top = getCellCoords(element).top.valueOf() + "px";
        buttonX = (Number.parseInt(singleDeckShip.style.left) - 55).toString() + "px";
        console.log("buttonX " + buttonX);
        buttonY = singleDeckShip.style.top;
        console.log("buttonY " + buttonY);
    }

    function showApplyButton() {
        const button = document.getElementById("applySingleDeckButton");
        button.style.left = buttonX;
        button.style.top = buttonY;
        button.hidden = false;
    }

    function hideApplyButton() {
        const button = document.getElementById("applySingleDeckButton");
        button.hidden = true;
    }

    function addSingleDeckShip(cell) {
        //let xhr = new XMLHttpRequest();
        //let url = '/game/' + sessionStorage.getItem("gameId") + '/fight_field/' + sessionStorage.getItem("owner") + '/ship';
        let singleDeckShipJSON = {
            type: "SINGLE",
            cells: [
                {
                    cellState: "SHIP",
                    coordinates: {
                        x: cell.dataset.x,
                        y: cell.dataset.y
                    }
                }
            ]
        }

        let data = JSON.stringify(singleDeckShipJSON);

        //xhr.open('PATCH', url, true);
        //xhr.setRequestHeader("Content-Type", "application/json");
        //xhr.setRequestHeader("Authorization", sessionStorage.getItem("token"));

        //alert("x " + singleDeckShip.cells.coordinates.x);
        //alert("y " + singleDeckShip.cells.coordinates.y);
        alert("ship " + data);

        //xhr.send(data);

        //xhr.onreadystatechange = function () {
        leaveDroppable(singleDeckShip);
        hideApplyButton();
        //}
    }
</script>

</body>
</html>